#!/bin/bash
# Crystallise
# Version:
export version='2.0'

# You need a file named config.txt in your home directory with a title, a collection identifier and a passphrase, each in its own line.

#Requires ia (https://pypi.python.org/pypi/internetarchive) to be installed and configured.

#Script must be run as root.

#Usage: crystallise <files>
#The file(s) being crystallised must be within the current directory. The script tests for some simple cases of this, but not all of them.

[ "$(whoami)" != "root" ] && exec sudo -- "$0" "$@"

#Script should exit if any operation fails.
set -e

if [ "$1" == "" ] || [ "$1" == "." ] || [ "$1" == ".." ] || [ "$1" == "./" ] || [[ "$1" =~ ^../ ]]; then
    echo "Please specify file(s) within the current directory to crystallise."
    exit 1
fi

CrystalID=Crystal-$(python -c 'import uuid; print str(uuid.uuid4())')-$(date +%Y.%m.%d.%H.%M.%S.%N)-$(xxd -pu <<< "$(date +%z)")
export CrystalID

crystallise-logsession "$CrystalID" "$@" 2>&1 | tee -a "$CrystalID"
