#!/bin/bash

cp -v "./assets/1_start.html" "../built/$1.htm";
cat "$1.htm" >> "../built/$1.htm";
cat "./assets/2_end.html" >> "../built/$1.htm";
tidy --new-blocklevel-tags "navigation, content" --output "../built/$1.htm" "../built/$1.htm";
html-minifier --output "../built/$1.htm" --remove-comments --use-short-doctype "../built/$1.htm";
tr '\n' ' ' < "../built/$1.htm" > "../built/1.tmp";
tr '\t' ' ' < "../built/1.tmp" > "../built/2.tmp";
tr '\r' ' ' < "../built/2.tmp" > "../built/3.tmp";
tr -s " " < "../built/3.tmp" > "../built/$1.htm";
perl -p -i -e 's/> </></g' "../built/$1.htm";
perl -p -i -e "s/nav-item-inactive $1/nav-item-selected/g" "../built/$1.htm";
perl -p -i -e "s/nav-item-inactive \w+/nav-item-inactive/g" "../built/$1.htm";
rm -v ../built/*.tmp;
